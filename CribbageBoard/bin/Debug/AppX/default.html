<!DOCTYPE html>

<html>

<head>

    <meta charset="utf-8" />

    <title>CribbageBoard</title>

    <!-- WinJS references -->
    <link href="//Microsoft.WinJS.1.0/css/ui-dark.css" rel="stylesheet" />
    <script src="//Microsoft.WinJS.1.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.1.0/js/ui.js"></script>

    <!-- HelloWorld references -->
    <link href="/css/default.css" rel="stylesheet" />
    <script src="/js/default.js"></script>

	<style>
    
        body {
        
            background:#000;
        
        }
		
		.drag { position: relative; }
    
    </style>

    <script src="/js/kinetic-v4.3.1.min.js"> </script>
    <script>
		var _startX = 0;            // mouse starting positions
		var _startY = 0;
		var _offsetX = 0;           // current element offset
		var _offsetY = 0;
		var _dragElement;           // needs to be passed from OnMouseDown to OnMouseMove
		var _oldZIndex = 0;         // we temporarily increase the z-index during drag
		var _debug = $('debug');    // makes life easier
		
		var rowOne = new Array();
    	var rowTwo = new Array();
    	var rowThree = new Array();
		
		var sourceY = 600;
		var sourceX = 1428;
		
		var _width = 1024;
		var _height = 768;
		
		var _page;
		var loader;
		
		var redPegOneIndex = -1;
		var redPegTwoIndex = -1;
		var selectedColor = "";
		var pegIndexes = [0,1,0,1,0,1];
		
		var xPos = 124;
		var yPos = 153;
		
		var rowOne = new Array();
		var rowTwo = new Array();
		var rowThree = new Array();
		
		var suites = ["h","s","c","d"];
		var numbers = ["1","2","3","4","5","6","7","8","9","10","j","q","k"];
		var deck = new Array();
		var pegRedOne;
		
		initDragDrop();
		buildArrays();

		function initDragDrop()
		{
			//document.onmousedown = OnMouseDown;
			//document.onmouseup = OnMouseUp;
		}
		
		function Point(x, y){
			this.x = x || 0;
			this.y = y || 0;
		};
		
		var stage;
		
		function showDots()
		{
			stage = new Kinetic.Stage({
				container: 'container',
				width: 1024,
				height: 768
			});

      		var layer = new Kinetic.Layer();
			
			for(var p = 2; p < rowOne.length; p++)
			{
				var rect = new Kinetic.Rect({
					x: rowOne[p].x,
					y: rowOne[p].y,
					width: 10,
					height: 10,
					fill: 'red',
				});

				// add the shape to the layer
				//layer.add(rect);
			}
			
			for(var q = 2; q < rowTwo.length; q++)
			{
				var rect = new Kinetic.Rect({
					x: rowTwo[q].x,
					y: rowTwo[q].y,
					width: 10,
					height: 10,
					fill: 'green',
				});

				// add the shape to the layer
				//layer.add(rect);
			}
			
			for(var w = 2; w < rowThree.length; w++)
			{
				var rect = new Kinetic.Rect({
					x: rowThree[w].x,
					y: rowThree[w].y,
					width: 10,
					height: 10,
					fill: 'blue',
				});

				// add the shape to the layer
				//layer.add(rect);
			}	
			// add the layer to the stage
      		stage.add(layer);
			var imageObj = new Image();
			imageObj.onload = function() {
				drawImage(this);
			};
			imageObj.src = 'images/circle.png';

			var imageObj2 = new Image();
			imageObj2.onload = function () {
			    drawImage(this);
			};
			imageObj2.src = 'images/circle.png';

		}
		var dot1;
		var dot2;
		
		function drawImage(imageObj) { 
			var layer = new Kinetic.Layer();
			// darth vader
			dot1 = new Kinetic.Image({
			  image: imageObj,
			  x: stage.getWidth() / 2 - 200 / 2,
			  y: stage.getHeight() / 2 - 137 / 2,
			  width: 40,
			  height: 40,
			  draggable: true
			});

			
			
			layer.add(dot1);


			stage.add(layer);
		}

		function drawImage2(imageObj) {
		    var layer = new Kinetic.Layer();
		    // darth vader
		    dot2 = new Kinetic.Image({
		        image: imageObj,
		        x: 200,
		        y: 200,
		        width: 40,
		        height: 40,
		        draggable: true
		    });

		    dot2.on("dragmove", function () {
		        var layer2 = new Kinetic.Layer();
		        var redLine = new Kinetic.Line({
		            points: [dot1.x, dot1.y, dot2.x, dot2.y],
		            stroke: 'red',
		            strokeWidth: 15,
		            lineCap: 'round',
		            lineJoin: 'round'
		        });
		        layer2.add(redLine);
		        stage.add(layer2);
		    });

		    layer.add(dot2);


		    stage.add(layer);
		}
		
		function buildArrays()
		{
		  
		  rowOne.push(new Point(59, 153));
		  rowOne.push(new Point(76,153));
		  
		  
		  rowTwo.push(new Point(59, 199));
		  rowTwo.push(new Point(76,199));
		  
		  
		  rowThree.push(new Point(59, 248));
		  rowThree.push(new Point(76,248));
		  
		  
		  for(var i = 1; i <= 35; i++)
		  {
			rowOne.push(new Point(xPos, yPos));
			rowTwo.push(new Point(xPos, yPos + 46));
			rowThree.push(new Point(xPos, yPos + 46 + 49));
			xPos += 16.45;
			if(i%5 == 0){
			  xPos += 24;
			}
			
		  }
		  
		  rowOne.push(new Point(886, 158.5));
		  rowOne.push(new Point(942,208.5));
		  rowOne.push(new Point(965.5, 284));
		  rowOne.push(new Point(948.5,359));
		  rowOne.push(new Point(896.5, 417.5));
		  
		  rowTwo.push(new Point(868.5, 209));
		  rowTwo.push(new Point(905, 240.5));
		  rowTwo.push(new Point(916.5, 284.5));
		  rowTwo.push(new Point(907, 327.5));
		  rowTwo.push(new Point(879, 366));
		  
		  rowThree.push(new Point(854, 257));
		  rowThree.push(new Point(866, 270));
		  rowThree.push(new Point(869.5, 287));
		  rowThree.push(new Point(867.5, 305));
		  rowThree.push(new Point(860, 319.5));
		  
		  
		  xPos -= 35;
		  yPos = 429;
		  
		  for(var n = 1; n <= 35; n++)
		  {
			rowOne.push(new Point(xPos, yPos));
			rowTwo.push(new Point(xPos, yPos - 46));
			rowThree.push(new Point(xPos, yPos - 46 - 47));
			xPos -= 16.8;
			if(n%5 == 0){
			  xPos -= 9.9;
			}
			
		  }
		  
		  rowOne.push(new Point(169.5, 441.5));
		  rowOne.push(new Point(159.5, 457.5));
		  rowOne.push(new Point(155.5, 474));
		  rowOne.push(new Point(158.5, 492));
		  rowOne.push(new Point(170.5, 506.5));
		  
		  rowTwo.push(new Point(156.5, 384));
		  rowTwo.push(new Point(121, 419));
		  rowTwo.push(new Point(104, 471));
		  rowTwo.push(new Point(117.5, 521.5));
		  rowTwo.push(new Point(156.5, 555));
		  
		  rowThree.push(new Point(142.5, 338));
		  rowThree.push(new Point(77.5, 393.5));
		  rowThree.push(new Point(58.5, 469.5));
		  rowThree.push(new Point(79, 548));
		  rowThree.push(new Point(139, 605));
		  
		  xPos += 24;
		  yPos = 517.5;
		  
		  for(var m = 1; m <= 40; m++)
		  {
			rowOne.push(new Point(xPos, yPos));
			rowTwo.push(new Point(xPos, yPos + 46));
			rowThree.push(new Point(xPos, yPos + 46 + 49));
			xPos += 16.5;
			if(m%5 == 0){
			  xPos += 10.8;
			}
			
		  }
		  
		  rowOne.push(new Point(970.5, 561.5));
		  
		  rowTwo.push(new Point(970.5, 561.5));
		  
		  rowThree.push(new Point(970.5, 561.5));
		}

		function placePeg(peg, row)
		{
		  var blueIndex = 0;
		  var closest = 500;
		  var pegPoint = new Point(peg.x, peg.y);
		  for(var p = 0; p < row.length; p++)
		  {
			var dist = getDistanceGivenPoints(pegPoint, row[p]);
			
			if(dist < closest){
			  closest = dist;
			  blueIndex = p;
			}
		  }
		  switch(peg){
			case _page.pegBlueOne:
			  if(blueIndex == pegIndexes[1]){
				blueIndex ++;
			  }
			  break;
			case _page.pegBlueTwo:
			  if(blueIndex == pegIndexes[0]){
				blueIndex ++;
			  }
			  break;
			case _page.pegYellowOne:
			  if(blueIndex == pegIndexes[3]){
				blueIndex ++;
			  }
			case _page.pegYellowTwo:
			  if(blueIndex == pegIndexes[2]){
				blueIndex ++;
			  }
			  break;
			case _page.pegRedOne:
			  if(blueIndex == pegIndexes[5]){
				blueIndex ++;
			  }
			  break;
			case _page.pegRedTwo:
			  if(blueIndex == pegIndexes[4]){
				blueIndex ++;
			  }
			  break;
		  }
		  if(blueIndex > row.length - 1){
			blueIndex = 0;
		  }
		  peg.x = row[blueIndex].x;
		  peg.y = row[blueIndex].y;
		  return blueIndex;
		}
		
		function OnMouseDown(e)
		{
			// IE is retarded and doesn't pass the event object
			if (e == null) 
				e = window.event; 
			
			// IE uses srcElement, others use target
			var target = e.target != null ? e.target : e.srcElement;
		
			// for IE, left click == 1
			// for Firefox, left click == 0
			if ((e.button == 1 && window.event != null || 
				e.button == 0) && 
				target.className == 'drag')
			{
				// grab the mouse position
				_startX = e.clientX;
				_startY = e.clientY;
				
				
				// grab the clicked element's position
				_offsetX = ExtractNumber(target.style.left);
				_offsetY = ExtractNumber(target.style.top);
				
				// bring the clicked element to the front while it is being dragged
				_oldZIndex = target.style.zIndex;
				target.style.zIndex = 10000;
				
				// we need to access the element in OnMouseMove
				_dragElement = target;
		
				// tell our code to start moving the element with the mouse
				document.onmousemove = OnMouseMove;
				
				// cancel out any text selections
				document.body.focus();
		
				// prevent text selection in IE
				document.onselectstart = function () { return false; };
				// prevent IE from trying to drag an image
				target.ondragstart = function() { return false; };
				
				// prevent text selection (except IE)
				return false;
			}
		}
		
		function OnMouseMove(e)
		{
			if (e == null) 
				var e = window.event; 
			
			var nextX = (_offsetX + e.clientX - _startX) ;
			var nextY = (_offsetY + e.clientY - _startY) ;
			
			if(nextX % 10 == 0){
				// this is the actual "drag code"
				_dragElement.style.left = nextX + 'px';
				_dragElement.style.top = nextY + 'px';
			}
		}
		
		function OnMouseUp(e)
		{
			if (_dragElement != null)
			{
				_dragElement.style.zIndex = _oldZIndex;
		
				// we're done with these events until the next OnMouseDown
				document.onmousemove = null;
				document.onselectstart = null;
				_dragElement.ondragstart = null;
		
				// this is how we know we're not dragging      
				_dragElement = null;
			}
		}
		
		function ExtractNumber(value)
		{
			var n = parseInt(value);
			
			return n == null || isNaN(n) ? 0 : n;
		}
		
		// this is simply a shortcut for the eyes and fingers
		function $(id)
		{
			return document.getElementById(id);
		}
	</script>

</head>

<body onLoad="showDots();">
    <div data-win-control="WinJS.UI.ViewBox">
        <div class="fixedlayout">
    <div id="container"></div>
    </div>
        </div>

</body>

</html>